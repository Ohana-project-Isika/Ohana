<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/WEB-INF/templates/default.xhtml">


    <ui:define name="content">
        <script type="text/javascript" src="#{request.contextPath}/resources/js/ticketing.js"></script>
        <link type="text/css" href="#{request.contextPath}/resources/css/styles.css" />

        <h:form id="panier">

            <h2>Votre panier</h2>
            <br/><br/>
                <h:outputText id="msg" value="" binding="#{eventController.component}"/>
                <h:message for="msg"/>
            <br/><br/>

            <h:dataTable value="#{eventController.cart.ticketsByIds.values()}" var="ticket" rendered="#{!eventController.cart.ticketsByIds.isEmpty()}">
                <h:column>
                    <f:facet name="header">Nom</f:facet>
                    #{ticket.event.name}
                </h:column>

                <h:column>
                    <f:facet name="header">Nombre de tickets Max</f:facet>
                    #{ticket.event.ticketQuantity}
                </h:column>

                <h:column>
                    <f:facet name="header">Tarif</f:facet>
                    #{ticket.rateType}
                </h:column>

                <h:column>
                    <f:facet name="header">Taux TVA</f:facet>
                    #{ticket.tvaRate} %
                </h:column>+

                <h:column>
                    <f:facet name="header">Prix HT</f:facet>
                    <p id="preTax_#{ticket.event.id}">
                        #{ticket.preTaxPrice} €
                    </p>
                </h:column>

                <h:column>
                    <f:facet name="header">Prix TTC</f:facet>
                    <p id="postTax_#{ticket.event.id}">
                        #{ticket.postTaxPrice} €
                    </p>
                </h:column>

                <h:column >
                    <h:commandButton action="#{eventController.decrement(ticket)}" value="-"/>
                    <h:inputText class="dynamicAmount" type="number"
                                 value="#{ticket.quantity}" min="1" max="#{ticket.event.ticketQuantity}"
                                 size="1"/>
                    <h:commandButton action="#{eventController.increment(ticket)}" value="+"/>
                </h:column>

                <h:column>
                    <f:facet name="header">Total HT</f:facet>
                    <p id="subTotal_#{ticket.event.id}">
                        #{ticket.preTaxPricePerQuantity} €
                    </p>
                </h:column>

                <h:column>
                    <f:facet name="header">Total TTC</f:facet>
                    <p id="total_#{ticket.event.id}">
                        #{ticket.postTaxPricePerQuantity} €
                    </p>
                </h:column>

                <h:column>
                    <f:facet name="header">Action</f:facet>
                    <h:commandButton action="#{eventController.delete(ticket)}" value="Supprimer" />
                </h:column>
            </h:dataTable>

            <h:panelGroup rendered="#{!eventController.cart.ticketsByIds.isEmpty()}">
                <h:outputLabel value="Total Panier HT : "/>
                <h:outputText value="#{eventController.cart.subTotal} €"/>
                <br/>
                <h:outputLabel value="Total Panier TTC : "/> :
                <h:outputText value="#{eventController.cart.total} €"/>
            </h:panelGroup>

            <h:panelGroup rendered="#{paymentController.paying}">
                <br/><br/>
                <h:outputText id="pmtMsg" value="" binding="#{paymentController.component}"/>
                <h:message for="pmtMsg"/>
                <br/><br/>
                <h:commandLink action="#{loginController.logIn}" value="Connectez-vous"/>
            </h:panelGroup>

            <h:panelGroup rendered="#{!paymentController.paying}">
                <br/><br/>
                <h:commandLink id="pay" action="#{paymentController.pay}" value="Valider le panier"/>
            </h:panelGroup>
            <br/><br/>
            <h:commandLink id="list" action="#{eventController.back}" value="Retour à la liste des événements"/>

        </h:form>
    </ui:define>
</ui:composition>
