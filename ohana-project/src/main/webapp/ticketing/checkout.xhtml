<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                template="/WEB-INF/templates/default.xhtml">


    <ui:define name="content">
        <script type="text/javascript" src="#{request.contextPath}/resources/js/ticketing.js"></script>
        <link type="text/css" href="#{request.contextPath}/resources/css/styles.css" />

        <h:form id="test">

            <h:dataTable value="#{eventController.cart.ticketsByQuantity.keySet()}" var="ticket">
                <h:column>
                    <f:facet name="header">Nom</f:facet>
                    #{ticket.event.name}
                </h:column>

                <h:column>
                    <f:facet name="header">Nombre de tickets Max</f:facet>
                    #{ticket.event.ticketQuantity}
                </h:column>

                <h:column>
                    <f:facet name="header">Tarif</f:facet>
                    #{ticket.rateType}
                </h:column>

                <h:column>
                    <f:facet name="header">Taux TVA</f:facet>
                    #{ticket.tvaRate} %
                </h:column>+

                <h:column>
                    <f:facet name="header">Prix HT</f:facet>
                    <p id="preTax_#{ticket.event.id}">
                        #{ticket.preTaxPrice} €
                    </p>
                </h:column>

                <h:column>
                    <f:facet name="header">Prix TTC</f:facet>
                    <p id="postTax_#{ticket.event.id}">
                        #{ticket.postTaxPrice} €
                    </p>
                </h:column>

                <h:column >
                    <h:commandButton action="#{eventController.decrement(ticket)}" value="-"/>
                    <input class="dynamicAmount" id="#{ticket.event.id}" type="number" value="#{eventController.cart.ticketsByQuantity.get(ticket)}" min="1" max="#{ticket.event.ticketQuantity}"/>
                    <h:commandButton action="#{eventController.increment(ticket)}" value="+"/>
                </h:column>

                <h:column >
                </h:column>

                <h:column>
                    <f:facet name="header">Total HT</f:facet>
                    <p id="subTotal_#{ticket.event.id}">
                        #{eventController.cart.subTotal} €
                    </p>
                </h:column>

                <h:column>
                    <f:facet name="header">Total TTC</f:facet>
                    <p id="total_#{ticket.event.id}">
                        #{eventController.cart.total} €
                    </p>
                </h:column>

                <h:column>
                    <f:facet name="header">Action</f:facet>
                    <h:commandButton action="#{eventController.delete(ticket.event)}" value="Supprimer" />
                </h:column>
            </h:dataTable>

            <f:facet name="header">Total Panier HT</f:facet>
            <p id="cartSubTotal">#{eventController.cart.subTotal}</p>
            <br/>

            <f:facet name="header">Total Panier TTC</f:facet>
            <p id="cartTotal">#{eventController.cart.total}</p>

            <h:commandLink id="list" action="#{eventController.back}" value="Retour à la liste des événements"/>
            <br/>
            <a href="#"><p onclick="getVars('#{eventController.cart.subTotal}', '#{eventController.cart.total}')">Payer</p></a>
            <div hidden="hidden">
                <h:inputHidden id="subTotal" value="#{paymentController.cartSubTotal}" />
                <h:inputHidden id="total" value="#{paymentController.cartTotal}" />
                <h:commandLink id="link" action="#{paymentController.pay(eventController.cart)}"
                               value="click"/>

            </div>
        </h:form>
    </ui:define>
</ui:composition>
